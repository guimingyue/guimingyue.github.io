---
layout: post
title: Effective Java 读书笔记 - 第七章
category: Effective Java
---
这一章主要讨论方法的设计需要注意的方面。

## 检查参数的有效性

大部分的构造方法和普通方法都对参数由限定，在执行具体的方法逻辑之前应该对方法的参数做校验，以便尽快发现不合要求的参数，进而暴露问题。对于类的`public`方法，可以使用 Javadoc 的`@throws`注解来说明参数错误时会抛出的异常，对于非`public`方法，通常应该使用断言（assertions）来检查参数的有效性，比如。

```java
private static void sort(long a[], int offset, int length) {
    assert a != null;
    assert offset >= 0 && offset <= a.length;
    assert offset >= 0 && length <= a.length - offset;
    // Method  body
}
```

需要注意的是，有些参数，方法指定过程中并没有用到，但是会保存再来供后续使用，这类参数检查尤为重要，构造方法是这类场景的特例，通常通过构造方法对成员变量进行赋值供后续使用。比如，

```java
public List<Integer> intArrayAsList(final int[] a) {
    if(a == null) {
        throw new NullPointerException();
    }
    return new AbstractList<Integer>() {
        public Integer get(int i) {
            return a[i];
        }
        
        public Integer set(int i, Integer val) {
            int oldVal = a[i];
            a[i] = val;
            return oldVal;
        }
        
        public int size() {
            return a.length;
        }
    };
}
```

对于参数检查的规则也有特殊的例外，如果参数检查消耗非常大，或者不切实际，而且参数检查隐含在实际代码执行中，那么就不需要在方法逻辑执行前对参数进行检查。比如`Collections.sort(List)`方法，在方法执行过程中，会进行各个对象之间的比较，如果有个元素的类型和其他元素不一样，那么就会抛出`ClassCastException`，所以在`sort`方法中，不需要单独对元素类型进行检查。

但是不要认为方法的任何参数限制都是好事，方法的设计应该尽可能的自然，对方法的参数限制越少，方法的通用性就越强，所以应该根据实际需要来校验参数。

